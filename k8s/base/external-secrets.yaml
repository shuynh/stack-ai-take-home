# ExternalSecret resources to sync SSM parameters to Kubernetes secrets

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-db-secrets
  namespace: supabase
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-parameter-store
    kind: SecretStore
  target:
    name: supabase-db
    creationPolicy: Owner
  data:
    - secretKey: host
      remoteRef:
        key: /ENV/supabase/postgres/host
    - secretKey: port
      remoteRef:
        key: /ENV/supabase/postgres/port
    - secretKey: database
      remoteRef:
        key: /ENV/supabase/postgres/database
    - secretKey: username
      remoteRef:
        key: /ENV/supabase/postgres/username
    - secretKey: password
      remoteRef:
        key: /ENV/supabase/postgres/password

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-jwt-secrets
  namespace: supabase
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-parameter-store
    kind: SecretStore
  target:
    name: supabase-jwt
    creationPolicy: Owner
  data:
    - secretKey: secret
      remoteRef:
        key: /ENV/supabase/jwt/secret
    - secretKey: anonKey
      remoteRef:
        key: /ENV/supabase/jwt/anon-key
    - secretKey: serviceRoleKey
      remoteRef:
        key: /ENV/supabase/jwt/service-role-key

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-dashboard-secrets
  namespace: supabase
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-parameter-store
    kind: SecretStore
  target:
    name: supabase-dashboard
    creationPolicy: Owner
  data:
    - secretKey: password
      remoteRef:
        key: /ENV/supabase/dashboard/password

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-s3-secrets
  namespace: supabase
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-parameter-store
    kind: SecretStore
  target:
    name: supabase-s3
    creationPolicy: Owner
  data:
    - secretKey: bucket
      remoteRef:
        key: /ENV/supabase/s3/bucket
    - secretKey: region
      remoteRef:
        key: /ENV/supabase/s3/region

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: supabase-smtp-secrets
  namespace: supabase
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-parameter-store
    kind: SecretStore
  target:
    name: supabase-smtp
    creationPolicy: Owner
  data:
    - secretKey: host
      remoteRef:
        key: /ENV/supabase/smtp/host
    - secretKey: port
      remoteRef:
        key: /ENV/supabase/smtp/port
    - secretKey: user
      remoteRef:
        key: /ENV/supabase/smtp/user
    - secretKey: password
      remoteRef:
        key: /ENV/supabase/smtp/password
